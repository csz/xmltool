<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Mycila XML Tool by mycila</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Mycila XML Tool</h1>
          <h2>XML manipulation library in Java built on a Fluent API</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/mycila/xmltool/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/mycila/xmltool/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/mycila/xmltool" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <p><strong>Table of Contents</strong></p>

<ul>
<li>
<a href="#mycila-xml-tool">Mycila XML Tool</a>

<ul>
<li><a href="#maven-repository">Maven Repository</a></li>
<li>
<a href="#documentation">Documentation</a>

<ul>
<li>
<a href="#creating-xml-documents">Creating XML documents</a>

<ul>
<li><a href="#creating-a-new-xml-document">Creating a new XML document</a></li>
<li><a href="#loading-an-existing-xml-document">Loading an existing XML document</a></li>
<li><a href="#ignoring-namespaces">Ignoring namespaces</a></li>
</ul>
</li>
<li>
<a href="#using-namespaces">Using namespaces</a>

<ul>
<li><a href="#adding-and-retrieving-namespaces-and-prefixes">Adding and retrieving namespaces and prefixes</a></li>
<li><a href="#prefix-constraints">Prefix constraints</a></li>
</ul>
</li>
<li>
<a href="#xml-elements-operations">XML elements operations</a>

<ul>
<li><a href="#on-elements">On elements</a></li>
<li><a href="#on-attributes">On attributes</a></li>
<li><a href="#on-text-and-data">On text and data</a></li>
</ul>
</li>
<li>
<a href="#navigation-xpath-and-callback-support">Navigation, XPath and Callback support</a>

<ul>
<li><a href="#raw-xpath">Raw XPath</a></li>
<li><a href="#gotos">Gotos</a></li>
<li><a href="#callbacks-on-selected-nodes">Callbacks on selected nodes</a></li>
</ul>
</li>
<li><a href="#converting-your-xml-document">Converting your XML document</a></li>
<li><a href="#validating-your-xml-document">Validating your XML document</a></li>
<li><a href="#exception-handling">Exception handling</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<h1>
<a id="mycila-xml-tool" class="anchor" href="#mycila-xml-tool" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mycila XML Tool</h1>

<p>XMLTool is a very simple Java library to be able to do all sorts of common operations with an XML document. As a Java developer, I often end up writing the always the same code for processing XML, transforming, ... So i decided to put all in a very easy to use class using the Fluent Interface pattern to facilitate XML manipulations.</p>

<pre><code>XMLTag tag = XMLDoc.newDocument(false)
    .addDefaultNamespace("http://www.w3.org/2002/06/xhtml2/")
    .addNamespace("wicket", "http://wicket.sourceforge.net/wicket-1.0")
    .addRoot("html")
    .addTag("wicket:border")
    .gotoRoot().addTag("head")
    .addNamespace("other", "http://other-ns.com")
    .gotoRoot().addTag("other:foo");
System.out.println(tag.toString());
</code></pre>

<p><strong>Features</strong></p>

<p>With XML Tool you will be able to quickly:</p>

<ul>
<li>Create new XML documents from external sources or new document from scrash</li>
<li>Manage namespaces</li>
<li>Manipulating nodes (add, remove, rename)</li>
<li>Manipulating data (add, remove text or CDATA)</li>
<li>Navigate into the document with shortcuts and XPath (note: XPath supports namespaces)</li>
<li>Tranform an XMlDoc instance to a String or a Document</li>
<li>Validate your document against schemas</li>
<li>Executin callbacks on a hierarchy</li>
<li>Remove all namspaces (namespace ignoring)</li>
<li>... and a lot of other features !</li>
</ul>

<p><strong>Project status</strong></p>

<ul>
<li>
<strong>Issues:</strong> <a href="https://github.com/mycila/xmltool/issues">https://github.com/mycila/xmltool/issues</a>
</li>
<li>
<strong>OSGI Compliant:</strong> <img width="100px" src="http://www.sonatype.com/system/images/W1siZiIsIjIwMTMvMDQvMTIvMTEvNDAvMzcvMTgzL05leHVzX0ZlYXR1cmVfTWF0cml4X29zZ2lfbG9nby5wbmciXV0/Nexus-Feature-Matrix-osgi-logo.png" title="OSGI Compliant">
</li>
<li>
<strong>Build Status:</strong> <a href="https://travis-ci.org/mycila/xmltool"><img src="https://travis-ci.org/mycila/xmltool.png?branch=master" alt="Build Status"></a>
</li>
</ul>

<h2>
<a id="maven-repository" class="anchor" href="#maven-repository" aria-hidden="true"><span class="octicon octicon-link"></span></a>Maven Repository</h2>

<p><strong>Releases</strong></p>

<p>Available in Maven Central Repository: <a href="http://repo1.maven.org/maven2/com/mycila/mycila-xmltool/">http://repo1.maven.org/maven2/com/mycila/mycila-xmltool/</a></p>

<p><strong>Snapshots</strong></p>

<p>Available in OSS Repository:  <a href="https://oss.sonatype.org/content/repositories/snapshots/com/mycila/mycila-xmltool/">https://oss.sonatype.org/content/repositories/snapshots/com/mycila/mycila-xmltool/</a></p>

<p><strong>Maven dependency</strong></p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.mycila&lt;/groupId&gt;
    &lt;artifactId&gt;mycila-xmltool&lt;/artifactId&gt;
    &lt;version&gt;X.Y.ga&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p><strong>Maven sites</strong></p>

<ul>
<li><a href="http://mycila.github.io/xmltool/reports/4.0.ga/index.html">4.0.ga</a></li>
</ul>

<h2>
<a id="documentation" class="anchor" href="#documentation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Documentation</h2>

<h3>
<a id="performance-consideration" class="anchor" href="#performance-consideration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Performance consideration</h3>

<p>XML Tool uses the Java DOM API and <code>Document</code> creation has a cost. Thus, to improve peformance, XML Tool uses 2 Object pools of <code>DocumentBuilder</code> instances: </p>

<ul>
<li>one pool for namespace-aware document builders</li>
<li>another one ignoring namespaces</li>
</ul>

<p>You can configure the pools by using <code>XMLDocumentBuilderFactory.setPoolConfig(config)</code></p>

<p>By default, each of the 2 pools have the following configuration:</p>

<ul>
<li>min idle = 0</li>
<li>max idle = CPU core number</li>
<li>max total = CPU core number * 4</li>
<li>max wait time = -1</li>
</ul>

<p>If your application is heavily threaded and a lot of threads are using XMLTag concurrently, to avoid thread contention you might want to increase the max total to match your peak thread count and max idle to match your average thread count.</p>

<p>If your application does not use a lot of thread and often create documents, you could probably lower those numbers.</p>

<p>The goal is to have sufficient <code>DocumentBuilder</code> instances available in the pool to be able to "feed" your application as demand without waiting for these objects to become available.</p>

<p>Using an object pool is sure much more complicated, but it will prevent any threading issues and also maximize performance because of object reuse.</p>

<h3>
<a id="creating-xml-documents" class="anchor" href="#creating-xml-documents" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating XML documents</h3>

<h4>
<a id="creating-a-new-xml-document" class="anchor" href="#creating-a-new-xml-document" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a new XML document</h4>

<p>The <code>newDocument</code> method crate a new XML document. You then have to choose a default namespace if you want and then choose the root name of the document.</p>

<pre><code>System.out.println(XMLDoc.newDocument(true).addRoot("html").toString());
</code></pre>

<p>gives:</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;html/&gt;
</code></pre>

<h4>
<a id="loading-an-existing-xml-document" class="anchor" href="#loading-an-existing-xml-document" aria-hidden="true"><span class="octicon octicon-link"></span></a>Loading an existing XML document</h4>

<p>The <code>from</code> methods can load an XML document from any of the following types:</p>

<ul>
<li>org.w3c.dom.Node</li>
<li>InputSource</li>
<li>Reader</li>
<li>InputStream</li>
<li>File</li>
<li>URL</li>
<li>String</li>
<li>javax.xml.transform.Source</li>
</ul>

<p><strong>Example:</strong></p>

<pre><code>URL yahooGeoCode = new URL("http://local.yahooapis.com/MapsService/V1/geocode?appid=YD-9G7bey8_JXxQP6rxl.fBFGgCdNjoDMACQA--&amp;state=QC&amp;country=CA&amp;zip=H1W3B8");
System.out.println(XMLDoc.from(yahooGeoCode, true).toString());
System.out.println(XMLDoc.from(yahooGeoCode, true).getText("Result/City"));
</code></pre>

<p>outputs:</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;ResultSet xmlns="urn:yahoo:maps" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:yahoo:maps http://api.local.yahoo.com/MapsService/V1/GeocodeResponse.xsd"&gt;
&lt;Result precision="zip"&gt;
    &lt;Latitude&gt;45.543289&lt;/Latitude&gt;
    &lt;Longitude&gt;-73.543098&lt;/Longitude&gt;
    &lt;Address/&gt;
    &lt;City&gt;Montreal&lt;/City&gt;
    &lt;State&gt;QC&lt;/State&gt;
    &lt;Zip&gt;H1W 3B8&lt;/Zip&gt;
    &lt;Country&gt;CA&lt;/Country&gt;
&lt;/Result&gt;
&lt;/ResultSet&gt;
&lt;!-- ws04.search.re2.yahoo.com uncompressed Tue Dec  9 13:39:12 PST 2008 --&gt;

Montreal
</code></pre>

<h4>
<a id="ignoring-namespaces" class="anchor" href="#ignoring-namespaces" aria-hidden="true"><span class="octicon octicon-link"></span></a>Ignoring namespaces</h4>

<p>All creational methods <code>XMLDoc.newDocument</code> and <code>XMLDoc.from</code> requires a boolean attribute <code>ignoreNamespaces</code>. If this attribute is set to true, all namespaces in the document are ignored. This is really useful if you use XPath a lot since you can avoid prefixing all your XPath elements.</p>

<p><strong>Example:</strong></p>

<pre><code>System.out.println(XMLDoc.newDocument(true)
    .addDefaultNamespace("http://www.w3.org/2002/06/xhtml2/")
    .addRoot("html"));
System.out.println(XMLDoc.newDocument(false)
    .addDefaultNamespace("http://www.w3.org/2002/06/xhtml2/")
    .addRoot("html"));
</code></pre>

<p>outputs:</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;html/&gt;

&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;html xmlns="http://www.w3.org/2002/06/xhtml2/"/&gt;
</code></pre>

<p>Navigating in a document with namespaces using XPath is quite a pain:</p>

<pre><code>doc.gotoTag("ns0:body").addTag("child")
   .gotoParent().addCDATA("with special characters")
   .gotoTag("ns0:body").addCDATA("&lt;\"!@#$%'^&amp;*()&gt;")
</code></pre>

<p>whereas if you load the same document with <code>ignoreNamespaces</code>, you can simply navigate like this when you use XPath:</p>

<pre><code>doc.gotoTag("body").addTag("child")
   .gotoParent().addCDATA("with special characters")
   .gotoTag("body").addCDATA("&lt;\"!@#$%'^&amp;*()&gt;")
</code></pre>

<h3>
<a id="using-namespaces" class="anchor" href="#using-namespaces" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using namespaces</h3>

<p>When you create or load a document, and if you decide to not ignore namespaces, you can add a default namespace for your document and add other ones after. Namespace management is quite a challenge, specifically when using XPath. When you have an XMLTag instance, you have access to the following methods to manage namespaces in the document:</p>

<h4>
<a id="adding-and-retrieving-namespaces-and-prefixes" class="anchor" href="#adding-and-retrieving-namespaces-and-prefixes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adding and retrieving namespaces and prefixes</h4>

<p><strong>addDefaultNamespace</strong></p>

<p>When you create an empty document, you can define a default namespace to use for the document. In example:</p>

<pre><code>XMLTag doc = XMLDoc.newDocument()
    .addDefaultNamespace("http://www.w3.org/2002/06/xhtml2/")
    .addRoot("html");
</code></pre>

<p>will produce:</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;html xmlns="http://www.w3.org/2002/06/xhtml2/"/&gt;
</code></pre>

<p><strong>addNamespace</strong></p>

<p>When you obtained an XMLTag instance, you can add any namespace you want. In example:</p>

<pre><code>XMLTag doc = XMLDoc.newDocument()
    .addDefaultNamespace("http://www.w3.org/2002/06/xhtml2/")
    .addNamespace("wicket", "http://wicket.sourceforge.net/wicket-1.0")
    .addRoot("html")
    .addTag("wicket:border")
    .gotoRoot().addTag("head")
    .addNamespace("other", "http://other-ns.com")
    .gotoRoot().addTag("other:foo");
</code></pre>

<p>will produce:</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;html xmlns="http://www.w3.org/2002/06/xhtml2/"&gt;
    &lt;wicket:border xmlns:wicket="http://wicket.sourceforge.net/wicket-1.0"/&gt;
    &lt;head/&gt;
    &lt;other:foo xmlns:other="http://other-ns.com"/&gt;
&lt;/html&gt;
</code></pre>

<p><strong>Namespace prefix generation</strong></p>

<p>When you load an existing XML document, or when you define a default namespace in a new document, prefixes and namespaces are automatically found in the whole document. Often, XML documents have default namespace. This is often the case for example in XHTML documents, like below. For this case, XMLDoc will generate for you a prefix that you can use for XPath navigation, and register the namespace as being the default one.</p>

<p>In example, the following document will have a default namespace and also a prefix generated to access it: <code>ns0</code>.</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" lang="en"&gt;
    &lt;head&gt;
        &lt;title/&gt;
    &lt;/head&gt;
    &lt;body/&gt;
&lt;/html&gt;

XMLTag doc = XMLDoc.from(...);
assertEquals(doc.getPrefix("http://www.w3.org/1999/xhtml"), "ns0");
assertEquals(doc.getContext().getNamespaceURI("ns0"), "http://www.w3.org/1999/xhtml");
</code></pre>

<p>The prefix 'ns0' has been generated in the namespace context of the document so that XPath expression can use it.</p>

<p>You can access the javax.xml.namespace.NamespaceContext like this:</p>

<pre><code>NamespaceContext ctx = doc.getContext();
</code></pre>

<h4>
<a id="prefix-constraints" class="anchor" href="#prefix-constraints" aria-hidden="true"><span class="octicon octicon-link"></span></a>Prefix constraints</h4>

<p>You cannot override an already defined prefix in a context, and you cannot override default XML prefixes. The following 3 attempts will throw an exception:</p>

<pre><code>// these prefixes are reserved
XMLDoc.newDocument().addRoot("html").addNamespace("xml", "http://ns0");
XMLDoc.newDocument().addRoot("html").addNamespace("xmlns", "http://ns0");

// shows namespace generation prefix: when we add default prefix, 'ns0' is also created (or another if it already exists). So we cannot bind another namespace to this prefix.
XMLDoc.newDocument()
    .addDefaultNamespace("http://def")
    .addRoot("html")
    .addNamespace("ns0", "http://ns0");
</code></pre>

<h3>
<a id="xml-elements-operations" class="anchor" href="#xml-elements-operations" aria-hidden="true"><span class="octicon octicon-link"></span></a>XML elements operations</h3>

<h4>
<a id="on-elements" class="anchor" href="#on-elements" aria-hidden="true"><span class="octicon octicon-link"></span></a>On elements</h4>

<p>Operations affecting elements: <code>hasTag</code>, <code>addTag</code>, <code>getCurrentTag</code>, <code>getCurrentTagName</code>, <code>deleteChilds</code>, <code>delete</code>, <code>renameTo</code></p>

<p><strong>hasTag</strong></p>

<p>Check for the existence of a tag.</p>

<p><strong>addTag</strong></p>

<p>Create a new tag</p>

<pre><code>System.out.println(XMLDoc.newDocument(true)
        .addRoot("html")
        .addTag("head")
        .toString());
</code></pre>

<p>outputs:</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;html&gt;
    &lt;head/&gt;
&lt;/html&gt;
</code></pre>

<p><strong>getCurrentTag</strong></p>

<p>Returns the current <code>org.w3c.dom.Element</code>.</p>

<p><strong>getCurrentTagName</strong></p>

<p>Returns the current tag name.</p>

<pre><code>System.out.println(XMLDoc.newDocument(true).addRoot("html").getCurrentTagName());
</code></pre>

<p>outputs:</p>

<pre><code>html
</code></pre>

<p><strong>delete</strong></p>

<p>Deletes the current tag. The parent tag of the deleted tag becomes  one the current tag. If we call delete on the root tag, an exception is thrown. Root node can only be renamed.</p>

<pre><code>System.out.println(XMLDoc.newDocument(true)
        .addRoot("html")
        .addTag("head")
        .delete()
        .toString());
</code></pre>

<p>outputs:</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;html/&gt;
</code></pre>

<p><strong>deleteChilds</strong></p>

<p>Deletes all tags under the current tag.</p>

<pre><code>System.out.println(XMLDoc.newDocument(true)
        .addRoot("html")
        .addTag("head").addTag("title")
        .toString());
System.out.println(XMLDoc.newDocument(true)
        .addRoot("html")
        .addTag("head").addTag("title")
        .gotoRoot().deleteChilds()
        .toString());
</code></pre>

<p>outputs:</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title/&gt;
    &lt;/head&gt;
&lt;/html&gt;

&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;html/&gt;
</code></pre>

<p><strong>renameTo</strong></p>

<p>Rename a tag to another name.</p>

<pre><code>System.out.println(XMLDoc.newDocument(true)
    .addRoot("html")
    .renameTo("xhtml")
    .toString());
</code></pre>

<p>outputs:</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;html/&gt;
</code></pre>

<h4>
<a id="on-attributes" class="anchor" href="#on-attributes" aria-hidden="true"><span class="octicon octicon-link"></span></a>On attributes</h4>

<p>Operations affecting elements: <code>hasAttribute</code>, <code>getAttributeNames</code>, <code>getAttribute</code>, <code>deleteAttributes</code>, <code>deleteAttribute</code></p>

<p>Supposing we load the following XML file:</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"&gt;
&lt;head&gt;
    &lt;title&gt;my title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id="header" class="banner"&gt;&lt;/div&gt;
    &lt;div id="content" class="cool"&gt;&lt;/div&gt;
    &lt;div id="footer" class="end"&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p><strong>hasAttribute</strong></p>

<p>Check for the existence of an attribute.</p>

<p><strong>getAttributeNames</strong></p>

<p>Returns a list of attribute names of the current tag.</p>

<pre><code>String[] names = XMLDoc.from(resource("test.xhtml"), true)
        .gotoTag("body/div[1]")
        .getAttributeNames();
System.out.println(Arrays.toString(names));
</code></pre>

<p>outputs:</p>

<pre><code>[class, id]
</code></pre>

<p><strong>getAttribute</strong></p>

<p>Returns an attribute value of the current tag or the selected tag by the XPath expression. If the attribute does not exist, throws an exception.</p>

<pre><code>System.out.println(XMLDoc.from(resource("test.xhtml"), true)
        .gotoTag("body/div[1]")
        .getAttribute("class"));
System.out.println(XMLDoc.from(resource("test.xhtml"), true)
        .getAttribute("class", "body/div[2]"));
</code></pre>

<p>outputs:</p>

<pre><code>banner
cool
</code></pre>

<p><strong>deleteAttributes</strong></p>

<p>Deletes all attributes of a the current tag.</p>

<pre><code>System.out.println(XMLDoc.from(resource("test.xhtml"), true)
    .gotoTag("body/div[1]")
    .deleteAttributes()
    .toString());

&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"&gt;
&lt;head&gt;
    &lt;title&gt;my title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div/&gt;
    &lt;div class="cool" id="content"/&gt;
    &lt;div class="end" id="footer"/&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p><strong>deleteAttribute</strong></p>

<p>Deletes a specific attribute. If it does not exist, an exception is thrown.</p>

<pre><code>System.out.println(XMLDoc.from(getClass().getResource("/test.xhtml"), true)
        .hasAttribute("id", "body/div[1]"));
System.out.println(XMLDoc.from(getClass().getResource("/test.xhtml"), true)
        .gotoTag("body/div[1]").deleteAttribute("id")
        .hasAttribute("id"));

true
false
</code></pre>

<h4>
<a id="on-text-and-data" class="anchor" href="#on-text-and-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>On text and data</h4>

<p>Operations affecting elements: <code>addText</code>, <code>addCDATA</code>, <code>getAttribute</code>, <code>deleteAttributes</code>, <code>deleteAttribute</code></p>

<p><strong>addText</strong>, <strong>addCDATA</strong></p>

<p>Adds text or CDATA sections to the document. As you have seen above, you can mix text, data and tags under one tag. When we add text or data, the current tag automatically becomes the parent tag. This behavior facilitate document creation since most of the time you will have to add one text or one data per tag like this:</p>

<pre><code>System.out.println(XMLDoc.newDocument(true)
    .addRoot("html")
    .addTag("head").addText("&lt;\"!@#$%'^&amp;*()&gt;")
    .addTag("body").addCDATA("&lt;\"!@#$%'^&amp;*()&gt;")
    .toString());
</code></pre>

<p>which gives:</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;html&gt;
    &lt;head&gt;&amp;lt;"!@#$%'^&amp;amp;*()&amp;gt;&lt;/head&gt;
    &lt;body&gt;&lt;![CDATA[&lt;"!@#$%'^&amp;*()&gt;]]&gt;&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p><strong>getText</strong>, <strong>getCDATA</strong></p>

<p>Returns the text or data contained in the current tag or the targetted tag with the XPath expression. If the tag has no text, returns "".</p>

<p>Given:</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;html xmlns="http://www.w3.org/2002/06/xhtml2/" xmlns:ns0="http://wicket.sourceforge.net/wicket-1.0"&gt;
    &lt;head&gt;
        &lt;title ns0:id="titleID"&gt;my special title: &amp;lt;"!@#$%'^&amp;amp;*()&amp;gt;&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;![CDATA[my special data: ]]&gt;
        &lt;ns0:border&gt;
            &lt;div/&gt;
            child1
        &lt;/ns0:border&gt;
        &lt;ns0:border&gt;child2&lt;/ns0:border&gt;
        &lt;![CDATA[&lt;"!@#$%'^&amp;*()&gt;]]&gt;
        &lt;ns0:border&gt;child3&lt;/ns0:border&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>The following assertions are true:</p>

<pre><code>assertEquals(doc.getCurrentTag().getNodeType(), Document.ELEMENT_NODE);
assertEquals(doc.getCurrentTagName(), "html");
assertEquals(doc.getCurrentTagName(), "html");
assertEquals(doc.getPefix("http://www.w3.org/2002/06/xhtml2/"), "ns1"); // ns0 is already used in the document
assertEquals(doc.gotoTag("ns1:head/ns1:title").getText(), "my special title: &lt;\"!@#$%'^&amp;*()&gt;");
assertEquals(doc.getText("."), "my special title: &lt;\"!@#$%'^&amp;*()&gt;");
assertEquals(doc.getCDATA("../../ns1:body"), "my special data: &lt;\"!@#$%'^&amp;*()&gt;");
assertEquals(doc.getAttribute("ns0:id"), "titleID");
</code></pre>

<p>NB: we loaded the document by not ignorign namespaces. That's why you see required ns prefixes in XPath expressions.</p>

<h3>
<a id="navigation-xpath-and-callback-support" class="anchor" href="#navigation-xpath-and-callback-support" aria-hidden="true"><span class="octicon octicon-link"></span></a>Navigation, XPath and Callback support</h3>

<h4>
<a id="raw-xpath" class="anchor" href="#raw-xpath" aria-hidden="true"><span class="octicon octicon-link"></span></a>Raw XPath</h4>

<p>You can execute RAW XPath directly through Java Xpath API by using <code>rawXpath</code> methods:</p>

<ul>
<li>Boolan XMLTag.rawXpathBoolean(...)</li>
<li>Number XMLTag.rawXpathNumber(...)</li>
<li>String XMLTag.rawXpathString(...)</li>
<li>Node XMLTag.rawXpathNode(...)</li>
<li>NodeList XMLTag.rawXpathNodeSet(...)</li>
</ul>

<h4>
<a id="gotos" class="anchor" href="#gotos" aria-hidden="true"><span class="octicon octicon-link"></span></a>Gotos</h4>

<p>Navigation in the document is achieved by <code>gotos</code> methods</p>

<p><strong>gotoParent</strong></p>

<p>Returns to the parent tag, or remain to the root tag if we are already in the root tag.</p>

<p><strong>gotoRoot</strong></p>

<p>As it says, goes to the root tag.</p>

<p><strong>gotoChild</strong></p>

<p>Goes to the only existing child of a tag. It is just a useful method to traverse XML document from child to child when there are only one child per element. If you call this method when you are in a tag that does not contain exactly one child element, the method will throw an exception.</p>

<p><strong>gotoChild(int i)</strong></p>

<p>Goes to the Nth child of the current element. Index is from 1 up to <code>child number</code>, exactly like XPath array selection (child[i]) If the child at given position does not exist, an exception is thrown.</p>

<p><strong>gotoChild(String name)</strong></p>

<p>Goes to to the unique existing child element having given name. If there is no child with this name, or if there are more than one, an exception will be thrown.</p>

<p><strong>gotoTag(String relativeXpath, Object... arguments)</strong></p>

<p>Goes to to a tag element given an XPath expression. <code>arguments</code> is useful to parametrize the XPath expression with namespace prefixes for example. It uses String.format(). Remember when using XPath on a document with namespaces, you must always use prefixes even when the document has a default namespace.</p>

<p><strong>Example:</strong></p>

<p>Given:</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;html xmlns="http://www.w3.org/2002/06/xhtml2/" xmlns:w="http://wicket.sourceforge.net/wicket-1.0"&gt;
    &lt;head&gt;
        &lt;title w:id="title"/&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;w:border&gt;
            &lt;div/&gt;
            child1
        &lt;/w:border&gt;
        &lt;w:border&gt;child2&lt;/w:border&gt;
        &lt;w:border&gt;child3&lt;/w:border&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>We can browse the above document like this:</p>

<pre><code>XMLTag doc = XMLDoc.from(getClass().getResource("/goto.xml"), false);
        String ns = doc.getPefix("http://www.w3.org/2002/06/xhtml2/");
        doc.gotoChild("head")      // jump to the only 'head' tag under 'html'
                .gotoChild()       // jump to the only child of 'head'
                .gotoRoot()        // go to 'html'
                .gotoChild(2)      // go to child 'body'
                .gotoChild(3)      // go to third child 'w:border' having text 'child3'
                .gotoRoot()        // return to root
                .gotoTag("%1$s:body/w:border[1]/%1$s:div", ns); // xpath navigation with namespace
</code></pre>

<p>Notice the Xpath expression when we use namespace: as we load an existing document, we can get generated prefix for a namespace with the <code>getPrefix</code> method. Then we can use this generated prefix in our XPath. <code>%1$s</code> means that we take the first argument provided (see String.format() documentation). If you debug, you will see that the XPath expression is <code>ns0:body/w:border[1]/ns0:div</code>.</p>

<h4>
<a id="callbacks-on-selected-nodes" class="anchor" href="#callbacks-on-selected-nodes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Callbacks on selected nodes</h4>

<p>Callbacks: <code>forEach</code>, <code>forEachChilds</code></p>

<p>XMLTool enables you to execute callback actions for each node selected or each child nodes.</p>

<p><strong>Example:</strong></p>

<p>If we take back the XHTML example:</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"&gt;
&lt;head&gt;
    &lt;title&gt;my title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id="header" class="banner"&gt;&lt;/div&gt;
    &lt;div id="content" class="cool"&gt;&lt;/div&gt;
    &lt;div id="footer" class="end"&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>And we execute:</p>

<pre><code>XMLDoc.from(getClass().getResource("/test.xhtml"), true).forEachChild(new CallBack() {
    public void execute(XMLTag doc) {
        System.out.println(doc.getCurrentTagName());
    }

XMLDoc.from(getClass().getResource("/test.xhtml"), true).forEach(new CallBack() {
    public void execute(XMLTag doc) {
        System.out.println(doc.getAttribute("id"));
    }
}, "//div");
</code></pre>

<p>We obtain:</p>

<pre><code>head
body
header
content
footer
</code></pre>

<h3>
<a id="converting-your-xml-document" class="anchor" href="#converting-your-xml-document" aria-hidden="true"><span class="octicon octicon-link"></span></a>Converting your XML document</h3>

<p>Document conversion is done through <code>to*</code> methods.</p>

<p><strong>toDocument</strong></p>

<p>Converts to an org.w3c.dom.Document instance.</p>

<p><strong>toString</strong>
<strong>toString(String encoding)</strong></p>

<p>Converts to a formatted string, optionally giving an encoding. </p>

<p><strong>toBytes</strong></p>

<p>Convert to a byte array</p>

<p><strong>toResult</strong>, <strong>toStream</strong></p>

<p>Converts to streams. </p>

<p><strong>Example:</strong></p>

<pre><code>XMLDoc.newDocument(true).addRoot("html")
    .toResult(new DOMResult())
    .toStream(new StringWriter())
    .toStream(new ByteArrayOutputStream());
</code></pre>

<h3>
<a id="validating-your-xml-document" class="anchor" href="#validating-your-xml-document" aria-hidden="true"><span class="octicon octicon-link"></span></a>Validating your XML document</h3>

<p>XML validation enables to validate current document against a shema. Of course, to use this functionnality you need to create a document that does not ignore namespaces.</p>

<p><strong>validate</strong></p>

<p>This method is used to validate the document against schemas. It returns a ValidationResult instance containing all warning and error issued during validation.</p>

<p><strong>Example:</strong></p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;html xmlns="http://www.w3.org/2002/06/xhtml2/" xmlns:w="http://wicket.sourceforge.net/wicket-1.0"&gt;
    &lt;head&gt;
        &lt;title w:id="title"/&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;w:border&gt;
            &lt;div/&gt;
            child1
        &lt;/w:border&gt;
        &lt;w:border&gt;child2&lt;/w:border&gt;
        &lt;w:border&gt;child3&lt;/w:border&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<ul>
<li>Namespace <a href="http://www.w3.org/2002/06/xhtml2/">http://www.w3.org/2002/06/xhtml2/</a> is defined in schema <a href="http://www.w3.org/MarkUp/SCHEMA/xhtml2.xsd">http://www.w3.org/MarkUp/SCHEMA/xhtml2.xsd</a>
</li>
<li>Namespace <a href="http://wicket.sourceforge.net/wicket-1.0">http://wicket.sourceforge.net/wicket-1.0</a> is defined in schema <a href="http://wicket.sourceforge.net/wicket-1.0.xsd">http://wicket.sourceforge.net/wicket-1.0.xsd</a>
</li>
</ul>

<p>If we validate the XML document goto.xml seen above:</p>

<pre><code>ValidationResult results = XMLDoc.from(getClass().getResource("/goto.xml")).validate(
        new URL("http://www.w3.org/MarkUp/SCHEMA/xhtml2.xsd"),
        new URL("http://wicket.sourceforge.net/wicket-1.0.xsd")
);
assertFalse(results.hasError());
</code></pre>

<p>If we validate the following document created by us below:</p>

<pre><code>results = XMLDoc.newDocument()
        .addDefaultNamespace("http://www.w3.org/2002/06/xhtml2/")
        .addRoot("htmlZZ")
        .validate(new URL("http://www.w3.org/MarkUp/SCHEMA/xhtml2.xsd"));
assertTrue(results.hasError());
System.out.println(Arrays.deepToString(results.getErrorMessages()));
</code></pre>

<p>The output is:</p>

<pre><code>[cvc-elt.1: Cannot find the declaration of element 'htmlxxx'.]
</code></pre>

<h3>
<a id="exception-handling" class="anchor" href="#exception-handling" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exception handling</h3>

<p>Each operation causing an exception throws a XMLDocumentException with a described message.</p>

<p><a href="http://githalytics.com/mycila/xmltool"><img src="https://cruel-carlota.pagodabox.com/c89084a008d60a2378ce0b480d883d8e" alt="githalytics.com alpha" title="githalytics.com"></a></p>
        </section>

        <footer>
          Mycila XML Tool is maintained by <a href="https://github.com/mycila">mycila</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

                  <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-5669052-12");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

      </div>
    </div>
  </body>
</html>